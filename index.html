<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>アーユルヴェーダ体質診断</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --green-dark: #2d5016;
  --green-mid: #4a7c28;
  --green-light: #7ab648;
  --green-pale: #c8e6a0;
  --beige: #f5f0e1;
  --beige-dark: #e8dcc8;
  --beige-light: #faf7f0;
  --brown: #5c4033;
  --brown-light: #8b6f5e;
  --white: #ffffff;
  --shadow: 0 2px 8px rgba(0,0,0,0.1);
  --shadow-lg: 0 4px 16px rgba(0,0,0,0.12);
  --radius: 12px;
  --vata-color: #7b9ec7;
  --pitta-color: #d4845a;
  --kapha-color: #6aab7b;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
  background-color: var(--beige);
  color: var(--brown);
  line-height: 1.7;
  min-height: 100vh;
}

header {
  background: linear-gradient(135deg, var(--green-dark), var(--green-mid));
  color: var(--white);
  text-align: center;
  padding: 1.5rem 1rem;
}
header h1 { font-size: 1.5rem; font-weight: 700; letter-spacing: 0.05em; }
header p { font-size: 0.85rem; opacity: 0.9; margin-top: 0.3rem; }

.container { max-width: 640px; margin: 0 auto; padding: 1rem; }

/* Auto-detect info */
.auto-info { display: flex; gap: 0.75rem; margin-bottom: 1rem; }
.auto-info-item { flex: 1; background: var(--green-pale); border-radius: var(--radius); padding: 0.75rem; text-align: center; font-size: 0.85rem; box-shadow: var(--shadow); }
.auto-info-item .label { font-size: 0.75rem; color: var(--green-dark); font-weight: 600; }
.auto-info-item .value { font-size: 1.1rem; font-weight: 700; color: var(--green-dark); margin-top: 0.2rem; }

/* Progress bar */
.progress-wrap { background: var(--white); border-radius: var(--radius); padding: 1rem 1.25rem; margin-bottom: 1rem; box-shadow: var(--shadow); }
.progress-label { font-size: 0.85rem; font-weight: 600; color: var(--green-dark); margin-bottom: 0.4rem; }
.progress-track { height: 10px; background: var(--beige); border-radius: 5px; overflow: hidden; }
.progress-fill { height: 100%; background: linear-gradient(90deg, var(--green-mid), var(--green-light)); border-radius: 5px; transition: width 0.3s ease; }

/* Cards */
.card { background: var(--white); border-radius: var(--radius); box-shadow: var(--shadow); padding: 1.25rem; margin-bottom: 1rem; }
.card h2 { font-size: 1.1rem; color: var(--green-dark); margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--green-pale); }
.card h3 { font-size: 1rem; color: var(--green-mid); margin: 1rem 0 0.5rem; }
.card.unanswered { border: 2px solid #e67e22; }

/* Question card */
.q-number { display: inline-block; background: var(--green-mid); color: var(--white); font-size: 0.75rem; font-weight: 700; padding: 0.15rem 0.5rem; border-radius: 10px; margin-bottom: 0.4rem; }
.q-category { font-size: 0.78rem; color: var(--brown-light); margin-bottom: 0.3rem; }
.q-text { font-size: 0.95rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--brown); }

/* Radio options */
.radio-group { display: flex; flex-direction: column; gap: 0.5rem; }
.radio-option { position: relative; }
.radio-option input[type="radio"] { position: absolute; opacity: 0; width: 0; height: 0; }
.radio-option label {
  display: block; padding: 0.7rem 0.85rem; background: var(--beige-light); border: 2px solid var(--beige-dark); border-radius: 8px;
  cursor: pointer; font-size: 0.88rem; transition: all 0.2s; line-height: 1.5;
}
.radio-option label:hover { border-color: var(--green-light); background: #f0edd8; }
.radio-option input[type="radio"]:checked + label { border-color: var(--green-mid); background: #e6f4d7; color: var(--green-dark); font-weight: 600; }
.radio-option input[type="radio"]:focus-visible + label { outline: 2px solid var(--green-mid); outline-offset: 2px; }

/* Buttons */
.btn-diagnose {
  display: block; width: 100%; padding: 1rem;
  background: linear-gradient(135deg, var(--green-mid), var(--green-light));
  color: var(--white); border: none; border-radius: var(--radius);
  font-size: 1.15rem; font-weight: 700; cursor: pointer;
  transition: transform 0.15s, box-shadow 0.15s;
  box-shadow: var(--shadow); letter-spacing: 0.05em;
}
.btn-diagnose:hover { transform: translateY(-1px); box-shadow: var(--shadow-lg); }
.btn-diagnose:active { transform: translateY(0); }

.btn-reset {
  display: block; width: 100%; padding: 0.85rem;
  background: var(--beige-dark); color: var(--brown); border: none;
  border-radius: var(--radius); font-size: 1rem; font-weight: 600;
  cursor: pointer; margin-top: 1rem; transition: background 0.2s;
}
.btn-reset:hover { background: #d9ccb5; }

/* Results */
#results { display: none; }

.dosha-result-header { text-align: center; padding: 1.5rem 1rem; border-radius: var(--radius); margin-bottom: 1rem; color: var(--white); }
.dosha-result-header.vata { background: linear-gradient(135deg, #5a82a8, var(--vata-color)); }
.dosha-result-header.pitta { background: linear-gradient(135deg, #b86a3a, var(--pitta-color)); }
.dosha-result-header.kapha { background: linear-gradient(135deg, #4a8a5a, var(--kapha-color)); }
.dosha-result-header.vata_pitta { background: linear-gradient(135deg, #5a82a8, var(--pitta-color)); }
.dosha-result-header.vata_kapha { background: linear-gradient(135deg, #5a82a8, var(--kapha-color)); }
.dosha-result-header.pitta_kapha { background: linear-gradient(135deg, #b86a3a, var(--kapha-color)); }
.dosha-result-header.tridosha { background: linear-gradient(135deg, var(--vata-color), var(--pitta-color), var(--kapha-color)); }

.dosha-result-header .dosha-name { font-size: 1.8rem; font-weight: 700; }
.dosha-result-header .dosha-element { font-size: 1rem; opacity: 0.9; margin-top: 0.25rem; }
.dosha-result-header .dosha-chars { font-size: 0.85rem; opacity: 0.85; margin-top: 0.5rem; }

/* Score bars */
.score-bars { margin: 1rem 0; }
.score-bar-row { display: flex; align-items: center; margin-bottom: 0.5rem; }
.score-bar-label { width: 70px; font-size: 0.85rem; font-weight: 600; }
.score-bar-track { flex: 1; height: 22px; background: var(--beige); border-radius: 11px; overflow: hidden; margin: 0 0.5rem; }
.score-bar-fill { height: 100%; border-radius: 11px; transition: width 0.6s ease; }
.score-bar-fill.vata { background: var(--vata-color); }
.score-bar-fill.pitta { background: var(--pitta-color); }
.score-bar-fill.kapha { background: var(--kapha-color); }
.score-bar-value { width: 70px; text-align: right; font-size: 0.85rem; font-weight: 700; }

/* Advice */
.advice-text { background: var(--beige-light); border-left: 4px solid var(--green-mid); padding: 0.75rem 1rem; border-radius: 0 8px 8px 0; font-size: 0.9rem; margin: 0.5rem 0; }

/* Pose cards */
.pose-item { background: var(--beige-light); border-radius: 8px; padding: 0.85rem; margin-bottom: 0.6rem; }
.pose-item .pose-name { font-weight: 700; color: var(--green-dark); font-size: 0.95rem; }
.pose-item .pose-reason { font-size: 0.82rem; color: var(--brown-light); margin-top: 0.2rem; }
.pose-item .pose-tips { font-size: 0.82rem; color: var(--green-mid); margin-top: 0.2rem; font-style: italic; }

/* Food */
.food-list { list-style: none; }
.food-list li { padding: 0.4rem 0; border-bottom: 1px solid var(--beige); font-size: 0.88rem; }
.food-list li:last-child { border-bottom: none; }
.food-list .food-name { font-weight: 600; }
.food-list .food-reason { color: var(--brown-light); font-size: 0.8rem; }
.food-section-title { font-size: 0.9rem; font-weight: 700; margin: 0.75rem 0 0.4rem; padding: 0.3rem 0.6rem; border-radius: 6px; }
.food-section-title.recommend { background: #e6f4d7; color: var(--green-dark); }
.food-section-title.avoid { background: #f9e4d8; color: #8b3a1a; }

/* Wake time */
.wake-info { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 0.75rem; }
.wake-box { background: var(--beige-light); border-radius: 8px; padding: 0.75rem; text-align: center; }
.wake-box .wake-label { font-size: 0.75rem; color: var(--brown-light); }
.wake-box .wake-time { font-size: 1.3rem; font-weight: 700; color: var(--green-dark); }

/* Daily schedule */
.schedule-item { display: flex; gap: 0.75rem; margin-bottom: 0.6rem; }
.schedule-period { min-width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.85rem; flex-shrink: 0; margin-top: 0.1rem; }
.schedule-period.morning { background: #ffeaa7; }
.schedule-period.afternoon { background: #fab1a0; }
.schedule-period.night { background: #a29bfe; color: var(--white); }
.schedule-text { font-size: 0.88rem; }
.schedule-text strong { display: block; font-size: 0.9rem; color: var(--green-dark); }

footer { text-align: center; padding: 1.5rem 1rem; font-size: 0.75rem; color: var(--brown-light); }

@media (max-width: 600px) {
  header h1 { font-size: 1.25rem; }
  .container { padding: 0.75rem; }
  .auto-info { flex-direction: column; gap: 0.5rem; }
  .wake-info { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<header>
  <h1>アーユルヴェーダ体質診断</h1>
  <p>プラクリティ診断 — 15の質問であなたの体質を知る</p>
</header>

<div class="container">

  <div class="auto-info">
    <div class="auto-info-item">
      <div class="label">現在の季節</div>
      <div class="value" id="season-display"></div>
    </div>
    <div class="auto-info-item">
      <div class="label">現在の時間帯</div>
      <div class="value" id="time-display"></div>
    </div>
  </div>

  <!-- Form -->
  <div id="form-area">
    <div class="progress-wrap">
      <div class="progress-label" id="progress-label">回答数: 0 / 15</div>
      <div class="progress-track"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
    </div>
    <form id="diagnose-form">
      <div id="questions-container"></div>
      <button type="submit" class="btn-diagnose">診断する</button>
    </form>
  </div>

  <!-- Results -->
  <div id="results">
    <div id="dosha-header" class="dosha-result-header">
      <div class="dosha-name" id="result-dosha-name"></div>
      <div class="dosha-element" id="result-dosha-element"></div>
      <div class="dosha-chars" id="result-dosha-chars"></div>
    </div>
    <div class="card">
      <h2>ドーシャスコア</h2>
      <div class="score-bars" id="score-bars"></div>
      <div class="advice-text" id="balance-advice"></div>
    </div>
    <div class="card">
      <h2 id="seasonal-pose-title"></h2>
      <div id="seasonal-poses"></div>
    </div>
    <div class="card">
      <h2 id="time-pose-title"></h2>
      <div id="time-poses"></div>
    </div>
    <div class="card">
      <h2>食べ物アドバイス</h2>
      <div id="food-advice"></div>
    </div>
    <div class="card">
      <h2>起床・就寝のすすめ</h2>
      <div id="wake-advice"></div>
    </div>
    <div class="card">
      <h2>1日の過ごし方</h2>
      <div id="daily-schedule"></div>
    </div>
    <button class="btn-reset" id="btn-reset">もう一度診断する</button>
  </div>

</div>

<footer>アーユルヴェーダ体質診断 &copy; 2025 &mdash; 情報は一般的なもので、医療的なアドバイスではありません。</footer>

<script>
// ========== QUESTIONS (15) ==========
var questions = [
  { id:1,  category:"体格・骨格", question:"あなたの体型に最も近いものは？",
    vata:"細身で華奢、骨ばっている。体重が増えにくい", pitta:"中肉中背で均整がとれている。筋肉がつきやすい", kapha:"がっしり・ふくよかで骨太。体重が増えやすい" },
  { id:2,  category:"肌の質感", question:"あなたの肌の状態に最も近いものは？",
    vata:"乾燥しやすく、冷たい。かさつきやすい", pitta:"敏感で温かく、赤みやニキビができやすい", kapha:"しっとり滑らかで、脂っぽくなりやすい" },
  { id:3,  category:"髪の質", question:"あなたの髪質に最も近いものは？",
    vata:"細くて乾燥しやすい。くせ毛やパサつきがある", pitta:"細くて柔らかい直毛。白髪や薄毛になりやすい", kapha:"太くて豊かでしっとり。量が多くツヤがある" },
  { id:4,  category:"目", question:"あなたの目の特徴に最も近いものは？",
    vata:"小さめで乾きやすい。まばたきが多い", pitta:"鋭い印象で充血しやすい。光に敏感", kapha:"大きくて潤いがある。まつ毛が長い" },
  { id:5,  category:"消化力", question:"あなたの消化の特徴に最も近いものは？",
    vata:"不規則で、ガスが溜まりやすい。便秘気味", pitta:"旺盛で消化が速い。空腹を我慢できない", kapha:"ゆっくり安定している。食後に重く感じやすい" },
  { id:6,  category:"体温の傾向", question:"体温や温度の好みについて最も近いものは？",
    vata:"寒がりで冷え性。温かい場所が好き", pitta:"暑がりで体が熱い。涼しい場所が好き", kapha:"やや寒がりで湿気に弱い。乾燥した暖かさが好き" },
  { id:7,  category:"汗のかきやすさ", question:"汗のかき方に最も近いものは？",
    vata:"汗をかきにくい。肌が乾燥している", pitta:"汗をかきやすく、体臭が気になることがある", kapha:"適度に汗をかくが、冷たい汗をかくことがある" },
  { id:8,  category:"睡眠パターン", question:"あなたの睡眠の特徴に最も近いものは？",
    vata:"浅く不規則。寝つきが悪く途中で目が覚める", pitta:"中程度の深さ。夢を多く見る。暑くて目が覚めることがある", kapha:"深くて長い。寝起きが悪くもっと寝たい" },
  { id:9,  category:"活動パターン", question:"普段の行動パターンに最も近いものは？",
    vata:"素早くて変化が多い。複数のことを同時にやりがち", pitta:"計画的で効率的。目標に向かって集中する", kapha:"ゆっくりで安定。一つのことをコツコツ続ける" },
  { id:10, category:"精神傾向", question:"あなたの思考の特徴に最も近いものは？",
    vata:"創造的でアイデアが次々浮かぶが、気が散りやすい", pitta:"分析的で論理的。集中力が高く判断が速い", kapha:"穏やかで落ち着いている。記憶力が良く忘れにくい" },
  { id:11, category:"感情傾向", question:"ストレスを感じたとき、最もよくある反応は？",
    vata:"不安や恐れを感じ、落ち着かなくなる", pitta:"イライラや怒りを感じ、攻撃的になる", kapha:"引きこもりがちになり、無気力・憂鬱になる" },
  { id:12, category:"話し方", question:"あなたの話し方に最も近いものは？",
    vata:"速くて話題が飛びやすい。ジェスチャーが多い", pitta:"明瞭で説得力がある。論理的に話す", kapha:"ゆっくりで穏やか。落ち着いたトーンで話す" },
  { id:13, category:"食欲", question:"あなたの食欲のパターンに最も近いものは？",
    vata:"不規則でムラがある。食べ忘れることがある", pitta:"旺盛で食事を抜くとイライラする", kapha:"安定していて、食事を抜いても平気" },
  { id:14, category:"味の好み", question:"特に好む味は？",
    vata:"甘味・酸味・塩味（温かく重い食事を好む）", pitta:"甘味・苦味・渋味（冷たく爽やかな食事を好む）", kapha:"辛味・苦味・渋味（軽く刺激的な食事を好む）" },
  { id:15, category:"歩き方・動作", question:"あなたの歩き方や動作に最も近いものは？",
    vata:"速くて軽い。せかせかしている", pitta:"中程度で目的的。力強い歩き方", kapha:"ゆっくりで優雅。どっしりしている" }
];

// ========== DOSHA DATA ==========
var doshaInfo = {
  vata:        { name:"ヴァータ体質",        element:"風・空",               characteristics:"動き、変化、乾燥、冷たさ、軽さのエネルギー。創造性と柔軟性の源。", balance_advice:"規則正しい生活、温かい食事、十分な休息を心がけましょう。オイルマッサージや穏やかなヨガが助けになります。" },
  pitta:       { name:"ピッタ体質",          element:"火・水",               characteristics:"変換、熱、鋭さ、強さのエネルギー。知性とリーダーシップの源。", balance_advice:"クールダウン、適度な運動、辛すぎない食事を意識しましょう。自然の中でリラックスする時間が大切です。" },
  kapha:       { name:"カパ体質",            element:"水・地",               characteristics:"安定、潤い、重さ、ゆっくりのエネルギー。忍耐力と愛情の源。", balance_advice:"活動的に過ごし、軽めの食事、刺激的な体験を取り入れましょう。新しい挑戦がバランスを整えます。" },
  vata_pitta:  { name:"ヴァータ・ピッタ体質", element:"風・空 + 火・水",       characteristics:"動きと変換のエネルギーが強く、創造的かつ情熱的。行動力がありますが、燃え尽きに注意。", balance_advice:"規則正しい食事と十分な休息を心がけ、クールダウンの時間を設けましょう。" },
  vata_kapha:  { name:"ヴァータ・カパ体質",   element:"風・空 + 水・地",       characteristics:"変化と安定が共存する体質。柔軟性と忍耐力がありますが、冷えやすさに注意。", balance_advice:"温かい食事と適度な運動で体を温め、規則正しい生活リズムを保ちましょう。" },
  pitta_kapha: { name:"ピッタ・カパ体質",     element:"火・水 + 水・地",       characteristics:"強さと安定のエネルギー。体力と持久力に優れますが、溜め込みやすさに注意。", balance_advice:"軽めの食事と活発な運動を心がけ、リラックスの時間も大切にしましょう。" },
  tridosha:    { name:"トリ・ドーシャ体質",   element:"風・空 + 火・水 + 水・地", characteristics:"三つのドーシャが均等にバランスした珍しい体質。適応力が高く安定しています。", balance_advice:"季節や時間帯に合わせた柔軟な生活を心がけ、現在のバランスを維持しましょう。" }
};

// ========== YOGA / FOOD / WAKE / SCHEDULE DATA ==========
var seasonalPoses = {
  spring: {
    vata: [
      { name:"山のポーズ（ターダ・アーサナ）", reason:"春の不安定さを安定させる", tips:"大地にしっかり根を張るイメージで" },
      { name:"戦士のポーズI（ヴィーラバドラ・アーサナI）", reason:"下半身を強化し、グラウンディング", tips:"後ろ足のかかとをしっかり床に" },
      { name:"子どものポーズ（バーラ・アーサナ）", reason:"心を落ち着かせる", tips:"額を床につけて深い呼吸を" }
    ],
    pitta: [
      { name:"前屈（パスチモッターナ・アーサナ）", reason:"春の熱を冷ます", tips:"無理せず、気持ち良い範囲で" },
      { name:"魚のポーズ（マツヤ・アーサナ）", reason:"胸を開き、熱を放散", tips:"首に負担をかけないように" },
      { name:"ねじりのポーズ", reason:"デトックス効果", tips:"吐く息でねじりを深める" }
    ],
    kapha: [
      { name:"太陽礼拝（スーリヤ・ナマスカーラ）", reason:"春のだるさを吹き飛ばす", tips:"12ポーズを流れるように" },
      { name:"弓のポーズ（ダヌラ・アーサナ）", reason:"胸を開き、エネルギー活性化", tips:"呼吸を止めないように" },
      { name:"ねじった三角のポーズ", reason:"消化促進とデトックス", tips:"腰からねじる意識で" }
    ]
  },
  summer: {
    vata: [
      { name:"木のポーズ（ヴリクシャ・アーサナ）", reason:"夏の散漫さに集中力を", tips:"一点を見つめてバランスを" },
      { name:"座位の前屈", reason:"落ち着きをもたらす", tips:"ゆっくりとした動きで" },
      { name:"シャヴァ・アーサナ（屍のポーズ）", reason:"夏の疲れをリセット", tips:"10〜15分しっかり休息を" }
    ],
    pitta: [
      { name:"月礼拝（チャンドラ・ナマスカーラ）", reason:"夏の熱を鎮める", tips:"夕方以降に行うのが理想的" },
      { name:"肩立ちのポーズ（サルヴァンガ・アーサナ）", reason:"クーリング効果", tips:"首を守るためにブランケットを" },
      { name:"シータリー呼吸法", reason:"体温を下げる", tips:"舌を丸めて息を吸う" }
    ],
    kapha: [
      { name:"逆立ち（シールシャ・アーサナ）", reason:"夏の倦怠感を払拭", tips:"壁を使って安全に" },
      { name:"ラクダのポーズ（ウシュトラ・アーサナ）", reason:"胸を大きく開く", tips:"腰を守るため、お尻を引き締めて" },
      { name:"獅子のポーズ（シンハ・アーサナ）", reason:"喉の詰まりを解放", tips:"大きく「アー」と声を出して" }
    ]
  },
  autumn: {
    vata: [
      { name:"猫と牛のポーズ", reason:"秋の乾燥から背骨を守る", tips:"ゆっくりとした動きで脊柱をほぐす" },
      { name:"鳩のポーズ（カポタ・アーサナ）", reason:"股関節の柔軟性向上", tips:"ブランケットでサポートを" },
      { name:"仰向けの合蹠（スプタ・バッダ・コーナ・アーサナ）", reason:"リラクゼーション", tips:"10分以上キープして深いリラックスを" }
    ],
    pitta: [
      { name:"ハートオープナー系", reason:"秋の感情の整理", tips:"胸を開いて心も開放" },
      { name:"ヨガニドラ（瞑想的休息）", reason:"心の熱を冷ます", tips:"ガイド音声を使うのもおすすめ" },
      { name:"穏やかな前屈", reason:"内省を促す", tips:"競争心を手放して" }
    ],
    kapha: [
      { name:"ダイナミックなヴィンヤサフロー", reason:"秋の停滞を打破", tips:"呼吸と動きを連動させて" },
      { name:"プランクポーズのバリエーション", reason:"筋力維持", tips:"体幹を意識して30秒〜1分" },
      { name:"ジャンプスルー・ジャンプバック", reason:"代謝を上げる", tips:"アシュタンガヨガのトランジション" }
    ]
  },
  winter: {
    vata: [
      { name:"チャイルドポーズの長めキープ", reason:"冬の不安を和らげる", tips:"温かいブランケットをかけて" },
      { name:"脚を壁に上げるポーズ", reason:"血行促進と安らぎ", tips:"壁際で15〜20分" },
      { name:"優しいリストラティブヨガ", reason:"冬の疲れを癒す", tips:"プロップスを多用して完全リラックス" }
    ],
    pitta: [
      { name:"座位の瞑想", reason:"冬の内省に最適", tips:"背筋を伸ばして15〜30分" },
      { name:"優しいツイスト", reason:"内臓をケア", tips:"食後2時間以上空けて" },
      { name:"アヌローマ・ヴィローマ（交互鼻呼吸）", reason:"バランス調整", tips:"左右5回ずつから始める" }
    ],
    kapha: [
      { name:"活発な太陽礼拝", reason:"冬の重だるさ解消", tips:"朝一番に5〜10セット" },
      { name:"カパーラバーティ（火の呼吸）", reason:"代謝アップ", tips:"空腹時に108回" },
      { name:"バックベンド（後屈）系", reason:"胸を開き、エネルギー充填", tips:"ウォームアップを十分に" }
    ]
  }
};

var timePoses = {
  morning: {
    vata:  [{ name:"優しいストレッチ", reason:"朝の体を穏やかに目覚めさせる", duration:"5〜10分" }, { name:"猫と牛のポーズ", reason:"背骨を柔軟にし、1日の準備を", duration:"5分" }],
    pitta: [{ name:"月礼拝", reason:"朝のクールな状態を保ちながら体を動かす", duration:"10分" }, { name:"座位の瞑想", reason:"心を落ち着け、穏やかに1日をスタート", duration:"10〜15分" }],
    kapha: [{ name:"活発な太陽礼拝", reason:"朝の重だるさを吹き飛ばす", duration:"15〜20分" }, { name:"カパーラバーティ", reason:"代謝を上げ、頭をクリアに", duration:"3〜5分" }]
  },
  afternoon: {
    vata:  [{ name:"短い瞑想休憩", reason:"午後の散漫さをリセット", duration:"5分" }, { name:"壁を使った脚上げ", reason:"疲れた脚を休め、心を落ち着ける", duration:"5〜10分" }],
    pitta: [{ name:"穏やかな前屈", reason:"午後の熱を冷ます", duration:"10分" }, { name:"シータリー呼吸", reason:"体温を下げ、リフレッシュ", duration:"3〜5分" }],
    kapha: [{ name:"パワーヨガ短時間", reason:"午後の眠気を払拭", duration:"10〜15分" }, { name:"逆転のポーズ", reason:"血行を促進し、エネルギーアップ", duration:"5分" }]
  },
  evening: {
    vata:  [{ name:"リストラティブヨガ", reason:"1日の緊張をゆっくりほどく", duration:"20〜30分" }, { name:"仰向けのツイスト", reason:"背骨をリリースし、安らぎを", duration:"10分" }],
    pitta: [{ name:"ヨガニドラ", reason:"心身を深くリラックスさせる", duration:"20〜30分" }, { name:"前屈中心の練習", reason:"副交感神経を優位にする", duration:"15分" }],
    kapha: [{ name:"中程度の強度フロー", reason:"夕方のエネルギーを使い切る", duration:"30分" }, { name:"ツイスト系", reason:"消化を助け、デトックス", duration:"10分" }]
  },
  night: {
    vata:  [{ name:"ベッドヨガ", reason:"安らかな眠りへ導く", duration:"10分" }, { name:"ナディ・ショーダナ", reason:"神経系を整え、深い睡眠を", duration:"5〜10分" }],
    pitta: [{ name:"月光浴瞑想", reason:"心の熱を手放し、穏やかな夜を", duration:"10〜15分" }, { name:"シャヴァ・アーサナ", reason:"完全なリラクゼーションで1日を締めくくる", duration:"15〜20分" }],
    kapha: [{ name:"軽いストレッチ", reason:"心地よい疲労感で質の良い眠りを", duration:"10分" }, { name:"穏やかな呼吸法", reason:"副交感神経を優位にし、入眠をスムーズに", duration:"5分" }]
  }
};

var foods = {
  vata: {
    recommended: [
      { food:"温かいスープ", reason:"体を温め潤いを与えます" }, { food:"根菜類", reason:"グラウンディング効果があります" },
      { food:"ギー", reason:"乾燥を防ぎ、消化を助けます" }, { food:"アボカド", reason:"良質な脂質で体を潤します" },
      { food:"温かいミルク", reason:"心を落ち着かせ、安眠を促します" }, { food:"バナナ", reason:"甘味が心身の安定をもたらします" },
      { food:"ナッツ類", reason:"栄養豊富で満足感を与えます" }
    ],
    avoid: [
      { food:"生野菜サラダ", reason:"冷たく乾燥性を高めます" }, { food:"炭酸飲料", reason:"ガスでお腹が張りやすくなります" },
      { food:"カフェイン過多", reason:"不安を増幅させます" }, { food:"ドライフルーツ過剰", reason:"乾燥性を高めます" }
    ]
  },
  pitta: {
    recommended: [
      { food:"キュウリ", reason:"クーリング効果で体を冷やします" }, { food:"ココナッツ", reason:"体を冷やし潤いを与えます" },
      { food:"甘いフルーツ", reason:"熱を鎮め心を穏やかにします" }, { food:"コリアンダー", reason:"消化を助け体を冷やします" },
      { food:"緑葉野菜", reason:"ビタミン豊富で冷性があります" }, { food:"ミントティー", reason:"清涼感でリフレッシュできます" },
      { food:"豆腐", reason:"良質な植物性タンパク質です" }
    ],
    avoid: [
      { food:"辛い香辛料", reason:"熱を増幅させます" }, { food:"揚げ物", reason:"油が熱を高めます" },
      { food:"赤身肉過剰", reason:"体を温めすぎます" }, { food:"トマト過剰", reason:"酸味が熱を高めます" }
    ]
  },
  kapha: {
    recommended: [
      { food:"生姜", reason:"代謝を上げ消化力を高めます" }, { food:"黒胡椒", reason:"消化の火を強化します" },
      { food:"緑茶", reason:"軽い刺激と抗酸化作用があります" }, { food:"リンゴ", reason:"軽くて消化に良いです" },
      { food:"キノア", reason:"軽い穀物でエネルギー源になります" }, { food:"レモン", reason:"デトックス効果があります" },
      { food:"葉物野菜", reason:"軽さと新鮮さをもたらします" }
    ],
    avoid: [
      { food:"乳製品過剰", reason:"粘液を増やします" }, { food:"甘いデザート", reason:"重さを増します" },
      { food:"揚げ物", reason:"油が重さを加えます" }, { food:"小麦製品過剰", reason:"カパを増やします" }
    ]
  }
};

var wakeTimes = {
  vata:  { time:"6:00〜6:30", reason:"規則的なリズムがヴァータを安定させます。日の出の時間帯は穏やかで、散漫になりがちな心を落ち着かせてくれます。", bedtime:"22:00〜22:30" },
  pitta: { time:"5:30〜6:00", reason:"太陽が昇る前の涼しい時間帯が、ピッタの熱を抑えます。この時間の瞑想は心の炎を穏やかにします。", bedtime:"22:00" },
  kapha: { time:"5:00〜5:30", reason:"日の出前の活動がカパの重さを軽減します。早起きで1日を活動的にスタートすることで、だるさを防ぎます。", bedtime:"21:30〜22:00" }
};

var dailySchedules = {
  vata: {
    morning:"温かい白湯を飲んでからオイルマッサージ（アビヤンガ）を行い、穏やかなヨガで体を起こしましょう。朝食は温かく消化に良いものをしっかり食べて。",
    afternoon:"規則正しい時間に昼食を取り、食後は10分ほど休憩しましょう。午後の仕事は集中力が切れやすいので、短い瞑想で気持ちをリセット。",
    night:"夕食は早めに軽く済ませ、温かいミルクでリラックスタイムを。入浴でしっかり体を温めてから、決まった時間に就寝しましょう。"
  },
  pitta: {
    morning:"涼しい時間帯に起床し、穏やかな瞑想やクーリング呼吸法で1日をスタート。朝食は甘味と苦味を含む食事が理想的です。",
    afternoon:"昼食を1日のメインにし、しっかり栄養を取りましょう。午後は競争心を刺激する活動を控え、自然の中でリフレッシュすると良いです。",
    night:"夕食は軽めにし、辛いものは避けましょう。就寝前は画面を見ず、月明かりの散歩やリラックスできる読書で心を静めて。"
  },
  kapha: {
    morning:"早起きして朝日を浴びながら活発に体を動かしましょう。朝食は軽めにし、生姜入りのお湯で消化力を高めてから1日をスタート。",
    afternoon:"昼食は適量をよく噛んで食べ、食後は散歩や軽い運動で眠気を防ぎましょう。新しいことに挑戦する時間を作ると活力が出ます。",
    night:"夕食は少量で温かいものを早い時間に。夜は重くならないよう注意し、軽いストレッチの後、早めに就寝して十分な休息を取りましょう。"
  }
};

// ========== HELPERS ==========
function getSeason() {
  var m = new Date().getMonth() + 1;
  if (m >= 3 && m <= 5) return "spring";
  if (m >= 6 && m <= 8) return "summer";
  if (m >= 9 && m <= 11) return "autumn";
  return "winter";
}
function getSeasonJP(s) { return {spring:"春",summer:"夏",autumn:"秋",winter:"冬"}[s]; }
function getTimeOfDay() {
  var h = new Date().getHours();
  if (h >= 5 && h <= 9) return "morning";
  if (h >= 10 && h <= 16) return "afternoon";
  if (h >= 17 && h <= 20) return "evening";
  return "night";
}
function getTimeOfDayJP(t) { return {morning:"朝",afternoon:"昼",evening:"夕",night:"夜"}[t]; }
function escapeHTML(str) { var d = document.createElement("div"); d.appendChild(document.createTextNode(str)); return d.innerHTML; }

// ========== INIT ==========
var currentSeason = getSeason();
var currentTime = getTimeOfDay();
document.getElementById("season-display").textContent = getSeasonJP(currentSeason);
document.getElementById("time-display").textContent = getTimeOfDayJP(currentTime);

// Build question cards
var container = document.getElementById("questions-container");
for (var i = 0; i < questions.length; i++) {
  var q = questions[i];
  var opts = [
    { key:"vata",  text:q.vata },
    { key:"pitta", text:q.pitta },
    { key:"kapha", text:q.kapha }
  ];
  // Shuffle display order so it's not always A=vata
  // Use a seeded pseudo-shuffle based on question id for consistency
  var order = [[0,1,2],[1,2,0],[2,0,1],[0,2,1],[1,0,2],[2,1,0]];
  var shuffled = order[q.id % order.length];

  var html = '<div class="card" id="q-card-' + q.id + '">' +
    '<span class="q-number">Q' + q.id + '</span>' +
    '<div class="q-category">' + escapeHTML(q.category) + '</div>' +
    '<div class="q-text">' + escapeHTML(q.question) + '</div>' +
    '<div class="radio-group">';
  var labels = ["A","B","C"];
  for (var j = 0; j < 3; j++) {
    var opt = opts[shuffled[j]];
    html += '<div class="radio-option">' +
      '<input type="radio" name="q' + q.id + '" id="q' + q.id + '_' + opt.key + '" value="' + opt.key + '">' +
      '<label for="q' + q.id + '_' + opt.key + '">' + labels[j] + '. ' + escapeHTML(opt.text) + '</label></div>';
  }
  html += '</div></div>';
  container.insertAdjacentHTML("beforeend", html);
}

// Update progress on change
document.getElementById("diagnose-form").addEventListener("change", updateProgress);
function updateProgress() {
  var answered = 0;
  for (var i = 0; i < questions.length; i++) {
    var radios = document.getElementsByName("q" + questions[i].id);
    for (var j = 0; j < radios.length; j++) {
      if (radios[j].checked) { answered++; break; }
    }
  }
  var pct = Math.round((answered / 15) * 100);
  document.getElementById("progress-fill").style.width = pct + "%";
  document.getElementById("progress-label").textContent = "回答数: " + answered + " / 15";
}

// ========== SUBMIT ==========
document.getElementById("diagnose-form").addEventListener("submit", function(e) {
  e.preventDefault();
  var scores = { vata:0, pitta:0, kapha:0 };
  var unanswered = [];

  // Remove previous highlights
  for (var k = 0; k < questions.length; k++) {
    document.getElementById("q-card-" + questions[k].id).classList.remove("unanswered");
  }

  for (var i = 0; i < questions.length; i++) {
    var qId = questions[i].id;
    var radios = document.getElementsByName("q" + qId);
    var answered = false;
    for (var j = 0; j < radios.length; j++) {
      if (radios[j].checked) {
        scores[radios[j].value] += 1;
        answered = true;
        break;
      }
    }
    if (!answered) unanswered.push(qId);
  }

  if (unanswered.length > 0) {
    for (var u = 0; u < unanswered.length; u++) {
      document.getElementById("q-card-" + unanswered[u]).classList.add("unanswered");
    }
    alert("全ての質問に回答してください（未回答: Q" + unanswered.join(", Q") + "）");
    document.getElementById("q-card-" + unanswered[0]).scrollIntoView({ behavior:"smooth", block:"center" });
    return;
  }

  // Determine dosha type
  var sorted = [
    { key:"vata", score:scores.vata },
    { key:"pitta", score:scores.pitta },
    { key:"kapha", score:scores.kapha }
  ].sort(function(a,b) { return b.score - a.score; });

  var doshaType;
  var primaryDosha;
  var diff12 = sorted[0].score - sorted[1].score;
  var diff23 = sorted[1].score - sorted[2].score;
  var diff13 = sorted[0].score - sorted[2].score;

  // Tri-dosha: all within 2 points
  if (diff13 <= 2) {
    doshaType = "tridosha";
    primaryDosha = sorted[0].key;
  }
  // Eka-dosha: top is 4+ above both others
  else if (diff12 >= 4) {
    doshaType = sorted[0].key;
    primaryDosha = sorted[0].key;
  }
  // Dvi-dosha: top 2 within 3, both 3+ above third
  else if (diff12 <= 3 && diff23 >= 3) {
    var pair = [sorted[0].key, sorted[1].key].sort();
    doshaType = pair[0] + "_" + pair[1];
    primaryDosha = sorted[0].key;
  }
  // Fallback: use highest
  else {
    doshaType = sorted[0].key;
    primaryDosha = sorted[0].key;
  }

  renderResults(doshaType, primaryDosha, scores);
  document.getElementById("form-area").style.display = "none";
  document.getElementById("results").style.display = "block";
  window.scrollTo({ top:0, behavior:"smooth" });
});

// ========== RESET ==========
document.getElementById("btn-reset").addEventListener("click", function() {
  document.getElementById("results").style.display = "none";
  document.getElementById("form-area").style.display = "block";

  var form = document.getElementById("diagnose-form");
  form.reset();
  updateProgress();

  for (var k = 0; k < questions.length; k++) {
    document.getElementById("q-card-" + questions[k].id).classList.remove("unanswered");
  }

  currentSeason = getSeason();
  currentTime = getTimeOfDay();
  document.getElementById("season-display").textContent = getSeasonJP(currentSeason);
  document.getElementById("time-display").textContent = getTimeOfDayJP(currentTime);

  window.scrollTo({ top:0, behavior:"smooth" });
});

// ========== RENDER ==========
function renderResults(doshaType, primaryDosha, scores) {
  var info = doshaInfo[doshaType];

  // Header
  var header = document.getElementById("dosha-header");
  header.className = "dosha-result-header " + doshaType;
  document.getElementById("result-dosha-name").textContent = "あなたの体質: " + info.name;
  document.getElementById("result-dosha-element").textContent = "元素: " + info.element;
  document.getElementById("result-dosha-chars").textContent = info.characteristics;

  // Score bars with percentage
  var total = scores.vata + scores.pitta + scores.kapha;
  var barsHTML = "";
  var keys = ["vata","pitta","kapha"];
  var labels = { vata:"ヴァータ", pitta:"ピッタ", kapha:"カパ" };
  for (var i = 0; i < keys.length; i++) {
    var key = keys[i];
    var pct = total > 0 ? Math.round((scores[key] / total) * 100) : 0;
    barsHTML += '<div class="score-bar-row">' +
      '<span class="score-bar-label">' + labels[key] + '</span>' +
      '<div class="score-bar-track"><div class="score-bar-fill ' + key + '" style="width:' + pct + '%"></div></div>' +
      '<span class="score-bar-value">' + scores[key] + '点 (' + pct + '%)</span></div>';
  }
  document.getElementById("score-bars").innerHTML = barsHTML;
  document.getElementById("balance-advice").textContent = info.balance_advice;

  // Seasonal poses (use primaryDosha for data lookup)
  var seasonJP = getSeasonJP(currentSeason);
  document.getElementById("seasonal-pose-title").textContent = seasonJP + "のおすすめヨガポーズ";
  var sPoses = seasonalPoses[currentSeason][primaryDosha];
  var sPosesHTML = "";
  for (var s = 0; s < sPoses.length; s++) {
    sPosesHTML += '<div class="pose-item"><div class="pose-name">' + escapeHTML(sPoses[s].name) + '</div>' +
      '<div class="pose-reason">' + escapeHTML(sPoses[s].reason) + '</div>' +
      '<div class="pose-tips">' + escapeHTML(sPoses[s].tips) + '</div></div>';
  }
  document.getElementById("seasonal-poses").innerHTML = sPosesHTML;

  // Time poses
  var timeJP = getTimeOfDayJP(currentTime);
  document.getElementById("time-pose-title").textContent = timeJP + "の時間帯におすすめのポーズ";
  var tPoses = timePoses[currentTime][primaryDosha];
  var tPosesHTML = "";
  for (var t = 0; t < tPoses.length; t++) {
    tPosesHTML += '<div class="pose-item"><div class="pose-name">' + escapeHTML(tPoses[t].name) + '</div>' +
      '<div class="pose-reason">' + escapeHTML(tPoses[t].reason) + '</div>' +
      '<div class="pose-tips">推奨時間: ' + escapeHTML(tPoses[t].duration) + '</div></div>';
  }
  document.getElementById("time-poses").innerHTML = tPosesHTML;

  // Food
  var fData = foods[primaryDosha];
  var foodHTML = '<div class="food-section-title recommend">おすすめ食材</div><ul class="food-list">';
  for (var r = 0; r < fData.recommended.length; r++) {
    foodHTML += '<li><span class="food-name">' + escapeHTML(fData.recommended[r].food) + '</span> <span class="food-reason">— ' + escapeHTML(fData.recommended[r].reason) + '</span></li>';
  }
  foodHTML += '</ul><div class="food-section-title avoid">控えめにする食材</div><ul class="food-list">';
  for (var a = 0; a < fData.avoid.length; a++) {
    foodHTML += '<li><span class="food-name">' + escapeHTML(fData.avoid[a].food) + '</span> <span class="food-reason">— ' + escapeHTML(fData.avoid[a].reason) + '</span></li>';
  }
  foodHTML += '</ul>';
  document.getElementById("food-advice").innerHTML = foodHTML;

  // Wake time
  var wData = wakeTimes[primaryDosha];
  var wakeHTML = '<div class="wake-info">' +
    '<div class="wake-box"><div class="wake-label">推奨起床時刻</div><div class="wake-time">' + escapeHTML(wData.time) + '</div></div>' +
    '<div class="wake-box"><div class="wake-label">就寝目安</div><div class="wake-time">' + escapeHTML(wData.bedtime) + '</div></div></div>' +
    '<div class="advice-text">' + escapeHTML(wData.reason) + '</div>';
  document.getElementById("wake-advice").innerHTML = wakeHTML;

  // Daily schedule
  var sched = dailySchedules[primaryDosha];
  var schedHTML =
    '<div class="schedule-item"><div class="schedule-period morning">朝</div><div class="schedule-text"><strong>朝の過ごし方</strong>' + escapeHTML(sched.morning) + '</div></div>' +
    '<div class="schedule-item"><div class="schedule-period afternoon">昼</div><div class="schedule-text"><strong>昼の過ごし方</strong>' + escapeHTML(sched.afternoon) + '</div></div>' +
    '<div class="schedule-item"><div class="schedule-period night">夜</div><div class="schedule-text"><strong>夜の過ごし方</strong>' + escapeHTML(sched.night) + '</div></div>';
  document.getElementById("daily-schedule").innerHTML = schedHTML;
}
</script>
</body>
</html>